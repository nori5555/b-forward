# B站用户视频播放器 Widget

## 功能特点

✅ **获取用户全部视频** - 自动分页获取用户的所有投稿视频  
✅ **直接播放支持** - 在第三方app中直接播放B站视频，无需跳转  
✅ **智能缓存机制** - 1小时缓存，提高加载速度  
✅ **多种视频质量** - 支持1080P/720P/480P/360P多种画质  
✅ **代理播放功能** - 通过代理服务器提高跨应用兼容性  
✅ **多重备用链接** - 提供备用播放地址，确保播放成功率  
✅ **优雅降级** - 播放链接获取失败时自动降级为网页链接  

## 参数说明

### uid (必需)
- **类型**: 字符串
- **说明**: B站用户的UID
- **示例**: `7784568` (哔哩哔哩科技官方账号)
- **获取方法**: 访问用户主页，URL中的数字即为UID

### quality (可选)
- **类型**: 选择框
- **默认值**: 720P
- **可选项**:
  - `1080P`: 1080P高清 (需要较好的网络)
  - `720P`: 720P高清 (推荐)
  - `480P`: 480P标清
  - `360P`: 360P流畅 (网络较差时选择)

### proxy (可选)
- **类型**: 布尔值
- **默认值**: true
- **说明**: 是否使用代理服务器播放视频
- **建议**: 在第三方app中使用时建议开启

## 技术特性

### 智能缓存系统
- 缓存时长: 30分钟 (可配置)
- 缓存大小: 最多100个视频记录
- 缓存键值: 基于用户ID和视频质量
- 自动清理: 过期数据自动删除

### 多重播放链接获取
1. **官方HTML5 API** - 优先使用官方接口
2. **移动端API** - 备用移动端接口
3. **第三方解析** - 预留第三方解析接口

### 代理服务器支持
- 多个代理服务器轮询
- 自动测试代理可用性
- 失败时自动尝试下一个代理

### 兼容性处理
- 自动处理CORS跨域问题
- 适配不同的播放器格式
- 提供必要的HTTP头信息

## 使用示例

### 基础用法
```javascript
// 获取默认UP主的视频 (720P质量)
loadUserVideos({ uid: "7784568" })
```

### 高质量播放
```javascript
// 获取1080P高清视频
loadUserVideos({ 
  uid: "7784568", 
  quality: "1080P" 
})
```

### 无代理播放
```javascript
// 直连播放 (适合网络环境良好的情况)
loadUserVideos({ 
  uid: "7784568", 
  quality: "720P",
  proxy: false 
})
```

## 返回数据格式

### 视频项目结构
```javascript
{
  title: "视频标题",
  description: "UP主名称 · 播放次数 · 发布时间",
  icon: "视频封面URL",
  url: "播放链接或网页链接",
  type: "video" | "link",  // video=可直接播放, link=跳转网页
  duration: "视频时长 (MM:SS)",
  bvid: "B站视频ID",
  quality: "视频质量",
  originalUrl: "原始B站链接",
  headers: {  // 播放时需要的HTTP头 (仅type=video时)
    "Referer": "https://www.bilibili.com/",
    "User-Agent": "..."
  },
  backupUrls: ["备用播放链接1", "备用播放链接2"],  // 可选
  proxy: "代理服务器地址"  // 仅使用代理时
}
```

## 错误处理

### 常见错误及解决方案

1. **UID不存在或无权限**
   - 返回提示信息
   - 提供用户主页链接

2. **网络请求失败**
   - 自动重试机制
   - 降级为链接模式

3. **视频播放链接获取失败**
   - 尝试多种获取方法
   - 提供备用播放地址
   - 最终降级为网页链接

4. **代理服务器不可用**
   - 自动尝试其他代理
   - 失败时使用直连

## 性能优化

### 请求频率控制
- 分页请求间隔200ms
- 最多获取20页视频 (约1000个视频)
- 单次返回限制30个视频 (避免处理时间过长)

### 内存管理
- 缓存大小限制
- LRU淘汰策略
- 定时清理过期数据

## 注意事项

1. **版权声明**: 本工具仅供学习研究使用，请勿用于商业用途
2. **使用限制**: 请合理使用，避免频繁请求对B站服务器造成压力
3. **网络环境**: 建议在良好的网络环境下使用
4. **播放器兼容**: 不同的第三方app可能对视频格式有不同要求

## 更新日志

### v2.0.0
- ✨ 新增直接播放功能
- ✨ 新增代理服务器支持
- ✨ 新增多重播放链接获取
- ✨ 新增智能缓存系统
- ✨ 支持获取用户全部视频
- 🐛 修复ID匹配问题
- 🎨 优化用户体验

### v1.0.0
- 🎉 初始版本
- ✨ 基础视频列表获取功能